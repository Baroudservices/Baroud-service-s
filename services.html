<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Services - Baroud</title>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body{
      margin:0; padding:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:#0b1220;
      color:#fff;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .wrap{
      width:min(420px, 92vw);
      padding:22px;
    }
    .card{
      background:rgba(255,255,255,0.06);
      border-radius:26px;
      padding:26px 18px;
      box-shadow:0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      text-align:center;
    }
    h1{margin:8px 0 6px; font-size:34px; letter-spacing:0.5px;}
    #welcome{opacity:.85; margin-bottom:16px}
    .btn{
      width:100%;
      border:0;
      border-radius:18px;
      padding:16px 14px;
      margin:10px 0;
      font-size:18px;
      cursor:pointer;
      background:rgba(255,255,255,0.10);
      color:#fff;
    }
    .btn:active{transform:scale(.99)}
    #msg{margin-top:14px; opacity:.9}

    .fab{
      position:fixed;
      right:18px;
      bottom:18px;
      width:56px;height:56px;
      border-radius:50%;
      border:0;
      background:rgba(255,255,255,0.12);
      color:#fff;
      font-size:30px;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    .fab:active{transform:scale(.98)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Baroud Services</h1>
      <div id="welcome">...</div>

      <button class="btn" onclick="openWhats()">WhatsApp</button>
      <button class="btn" onclick="alert('Service 1')">Service 1</button>
      <button class="btn" onclick="alert('Service 2')">Service 2</button>

      <button class="btn" onclick="go('add-credit.html')">Add Credit</button>
      <button class="btn" onclick="logoutUser()">Logout</button>

      <div id="msg">...</div>
    </div>
  </div>

  <button class="fab" onclick="hardRefresh()" title="Refresh">â†»</button>

  <script>
    // âœ… Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ (GitHub Pages)
    const BASE = "https://baroudservices.github.io/Baroud-service-s/";

    // âœ… Supabase
    const supabase = window.supabase.createClient(
      "https://pqrwitolonhfbfwtsnde.supabase.co",
      "sb_publishable_l5PtPu6xVyWq2pD6jzEYRw_CYEQ9-f_"
    );

    const welcomeEl = document.getElementById("welcome");
    const msgEl = document.getElementById("msg");

    function openWhats(){
      window.open("https://wa.me/96170385398", "_blank");
    }

    // âœ… ØªÙ†Ù‚Ù‘Ù„ Ù…Ø¹ ÙƒØ³Ø± ÙƒØ§Ø´
    function go(page){
      window.location.assign(BASE + page + "?v=" + Date.now());
    }

    // âœ… Refresh Ù‚ÙˆÙŠ
    function hardRefresh(){
      window.location.replace(BASE + "services.html?v=" + Date.now());
    }

    async function logoutUser(){
      await supabase.auth.signOut();
      window.location.replace(BASE + "index.html?v=" + Date.now());
    }

    async function guard(){
      const { data } = await supabase.auth.getSession();
      const user = data?.session?.user;

      if(!user){
        window.location.replace(BASE + "index.html?v=" + Date.now());
        return;
      }
      welcomeEl.textContent = "Ø£Ù‡Ù„Ø§Ù‹ " + user.email;
      msgEl.textContent = "Ready âœ…";
    }

    guard();

    // ðŸ”¥ Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ: Ø­Ø°Ù Service Worker + Cache
    (async () => {
      try{
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const reg of regs) await reg.unregister();
        }
        if ('caches' in window) {
          const keys = await caches.keys();
          for (const k of keys) await caches.delete(k);
        }
      }catch(e){}
    })();
  </script>
</body>
</html>
