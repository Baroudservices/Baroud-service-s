<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Whish Money - Baroud</title>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body{
      margin:0; padding:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:#0b1220;
      color:#fff;
      min-height:100vh;
    }
    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px;
    }
    .btnIcon{
      width:50px;height:50px;
      border-radius:18px;
      border:0;
      background:rgba(255,255,255,0.10);
      color:#fff;
      font-size:22px;
      cursor:pointer;
      box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    .wrap{
      width:min(520px, 92vw);
      margin:0 auto;
      padding:10px 18px 30px;
    }
    h1{
      font-size:44px;
      margin:12px 0 16px;
    }
    .card{
      background:rgba(255,255,255,0.06);
      border-radius:28px;
      padding:22px 18px;
      box-shadow:0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }
    .idBox{
      background:rgba(255,255,255,0.10);
      border-radius:18px;
      padding:14px;
      font-size:22px;
      font-weight:700;
      text-align:center;
      margin:10px 0 16px;
    }
    .muted{opacity:.8; margin:8px 0}
    input{
      width:100%;
      border-radius:18px;
      border:0;
      padding:16px 14px;
      font-size:18px;
      margin:10px 0;
      outline:none;
    }
    .action{
      width:100%;
      border:0;
      border-radius:22px;
      padding:18px 14px;
      margin-top:12px;
      font-size:20px;
      font-weight:800;
      cursor:pointer;
      background:linear-gradient(90deg,#08b0ff,#1f7bff);
      color:#fff;
    }
    .footer{
      text-align:center;
      opacity:.6;
      margin-top:18px;
    }
    #out{margin-top:12px; font-weight:700;}
    .err{color:#ff8080}
    .ok{color:#7CFFB2}
  </style>
</head>

<body>
  <div class="top">
    <button class="btnIcon" onclick="goBack()">â†©</button>
    <button class="btnIcon" onclick="goBack()">â†’</button>
  </div>

  <div class="wrap">
    <h1>Whish Money $</h1>

    <div class="card">
      <div class="muted">Please send the amount to this number ID:</div>
      <div class="idBox">+961 8181 2024</div>

      <div class="muted">The minimum deposit is <b>10$</b></div>
      <div class="muted">It takes between <b>1</b> & <b>20</b> minutes</div>

      <input id="amount" type="number" placeholder="Enter amount $" min="10" />
      <input id="receipt" type="file" accept="image/*" />

      <button class="action" onclick="requestDeposit()">REQUEST</button>
      <div id="out"></div>

      <div class="footer">Â© 2024 Baroud Services</div>
    </div>
  </div>

  <script>
    const BASE = "https://baroudservices.github.io/Baroud-service-s/";

    const supabase = window.supabase.createClient(
      "https://pqrwitolonhfbfwtsnde.supabase.co",
      "sb_publishable_l5PtPu6xVyWq2pD6jzEYRw_CYEQ9-f_"
    );

    function goBack(){
      // âœ… Ø±Ø¬ÙˆØ¹ Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ add-credit.html (Ù…Ø§ Ø¨ÙŠØ±Ø¬Ø¹ Ù„ØªØ§Ø±ÙŠØ® Ù‚Ø¯ÙŠÙ…)
      window.location.replace(BASE + "add-credit.html?v=" + Date.now());
    }

    async function guard(){
      const { data } = await supabase.auth.getSession();
      const user = data?.session?.user;
      if(!user){
        window.location.replace(BASE + "index.html?v=" + Date.now());
        return;
      }
    }
    guard();

    function show(msg, ok=true){
      const out = document.getElementById("out");
      out.className = ok ? "ok" : "err";
      out.textContent = msg;
    }

    async function requestDeposit(){
      const amount = Number(document.getElementById("amount").value || 0);
      const file = document.getElementById("receipt").files[0];

      if(amount < 10){
        show("Minimum is 10$", false);
        return;
      }
      if(!file){
        show("Please choose receipt image", false);
        return;
      }

      // âœ… Ù‡ÙˆÙ† Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù†Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ù€ Storage + DB
      show("Request sent âœ…", true);
    }

    // ðŸ”¥ Ø­Ø°Ù SW + Cache
    (async () => {
      try{
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const reg of regs) await reg.unregister();
        }
        if ('caches' in window) {
          const keys = await caches.keys();
          for (const k of keys) await caches.delete(k);
        }
      }catch(e){}
    })();
  </script>
</body>
</html>
